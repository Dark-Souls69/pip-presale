<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Paws in Peace Memorial â€¢ Dualâ€‘Service Demo</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .glass { background: rgba(255,255,255,0.1); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.2); }
    .animate-float { animation: float 6s ease-in-out infinite; }
    @keyframes float { 0%,100%{transform:translateY(0)} 50%{transform:translateY(-10px)} }
    .tier-card { transition: transform .2s ease, background .2s ease, border-color .2s ease; }
    .tier-card:hover { transform: scale(1.02); }
    .selected-tier { border-color: #fbbf24 !important; background: rgba(251,191,36,.10); }
    .hidden { display: none; }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/ethers@6.12.1/dist/ethers.umd.min.js"></script>
</head>
<body class="min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 text-white">

  <!-- Safety Banner -->
  <div class="w-full bg-black/50 py-2 px-4 text-sm">ğŸ›¡ï¸ Public demo â€” never share seed phrases. We will <strong>never DM</strong> you for money.</div>

  <!-- Header -->
  <header class="glass backdrop-blur-md bg-white/10 border-b border-white/15">
    <div class="max-w-7xl mx-auto px-4 py-4 flex items-center justify-between">
      <button class="flex items-center gap-3" id="logoBtn">
        <div class="w-10 h-10 rounded-full bg-purple-600 grid place-items-center text-2xl">ğŸ¾</div>
        <div class="font-bold text-xl">Paws in Peace</div>
      </button>
      <div class="flex items-center gap-3">
        <button id="galleryBtn" class="px-3 py-2 rounded-lg bg-white/10 border border-white/30 hover:bg-white/20">Gallery</button>
        <select id="networkSelect" class="px-3 py-2 rounded-lg bg-white/10 border border-white/30">
          <option value="arbitrum">Arbitrum Network</option>
          <option value="ethereum">Ethereum Network</option>
        </select>
        <button id="connectBtn" class="px-4 py-2 rounded-lg bg-purple-600 hover:bg-purple-700">ğŸ‘› Connect Wallet</button>
      </div>
    </div>
  </header>

  <!-- Main -->
  <main class="max-w-7xl mx-auto px-4 py-8">
    <!-- HOME VIEW -->
    <section id="homeView" class="space-y-8">
      <div class="glass rounded-2xl p-8 text-center border border-white/20 animate-float">
        <div class="w-16 h-16 bg-gradient-to-br from-purple-500 to-purple-700 rounded-full grid place-items-center text-2xl border border-white/30 mx-auto mb-4">ğŸ¾</div>
        <h1 class="text-4xl font-extrabold mb-2">Honor Your Pet's Journey</h1>
        <p class="text-white/85 text-lg mb-6">Create beautiful onâ€‘chain memories for pets who are still with us, or eternal memorials for those who have passed.</p>
        <div class="grid md:grid-cols-2 gap-6 max-w-4xl mx-auto mt-8">
          <button id="lifetimeBtn" class="glass rounded-xl p-6 border-2 border-green-400/40 hover:bg-green-400/10 transition-all text-left">
            <div class="text-4xl mb-4">ğŸŒŸ</div>
            <h3 class="text-xl font-bold mb-2">Lifetime Memories</h3>
            <p class="text-white/80 text-sm mb-4">Create cherished memories while your pet is still with you. Capture their best moments, milestones, and daily joys.</p>
            <div class="text-green-400 font-semibold">Start Creating â†’</div>
          </button>
          <button id="restingBtn" class="glass rounded-xl p-6 border-2 border-blue-400/40 hover:bg-blue-400/10 transition-all text-left">
            <div class="text-4xl mb-4">ğŸ•Šï¸</div>
            <h3 class="text-xl font-bold mb-2">Resting Memorial</h3>
            <p class="text-white/80 text-sm mb-4">Honor pets who have crossed the rainbow bridge with a permanent, beautiful tribute.</p>
            <div class="text-blue-400 font-semibold">Create Memorial â†’</div>
          </button>
        </div>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
        <div class="glass rounded-xl p-6 text-center border border-white/20">
          <div class="text-3xl font-bold text-yellow-400 mb-1">1,247</div>
          <div class="text-sm text-white/80">Total Created</div>
        </div>
        <div class="glass rounded-xl p-6 text-center border border-white/20">
          <div class="text-3xl font-bold text-green-400 mb-1">892</div>
          <div class="text-sm text-white/80">Lifetime Memories</div>
        </div>
        <div class="glass rounded-xl p-6 text-center border border-white/20">
          <div class="text-3xl font-bold text-blue-400 mb-1">355</div>
          <div class="text-sm text-white/80">Resting Memorials</div>
        </div>
      </div>
    </section>

    <!-- LIFETIME VIEW -->
    <section id="lifetimeView" class="hidden space-y-8">
      <div class="flex items-center justify-between">
        <button class="flex items-center gap-2 text-white/80 hover:text-white" id="backFromLifetime">â€¹ Back to Home</button>
        <h2 class="text-3xl font-bold">ğŸŒŸ Lifetime Memories</h2>
        <div></div>
      </div>

      <div class="glass rounded-2xl p-6 border border-green-400/30">
        <p class="text-white/90 text-center mb-6">Create beautiful memories while your pet is healthy and happy. Perfect for celebrating milestones, birthdays, or just everyday joy!</p>

        <!-- Step 1: Template -->
        <div class="space-y-6">
          <h3 class="text-xl font-semibold">Step 1: Choose Design Template</h3>
          <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
            <button class="tier-card glass rounded-lg p-4 border border-white/20 text-center" data-template="playful">
              <div class="text-3xl mb-2">ğŸ¾</div>
              <div class="font-medium">Playful</div>
              <div class="text-white/60 text-sm">Fun & Energetic</div>
            </button>
            <button class="tier-card glass rounded-lg p-4 border border-white/20 text-center" data-template="elegant">
              <div class="text-3xl mb-2">âœ¨</div>
              <div class="font-medium">Elegant</div>
              <div class="text-white/60 text-sm">Sophisticated</div>
            </button>
            <button class="tier-card glass rounded-lg p-4 border border-white/20 text-center" data-template="cute">
              <div class="text-3xl mb-2">ğŸŒˆ</div>
              <div class="font-medium">Cute</div>
              <div class="text-white/60 text-sm">Adorable & Sweet</div>
            </button>
            <button class="tier-card glass rounded-lg p-4 border border-white/20 text-center" data-template="nature">
              <div class="text-3xl mb-2">ğŸŒ¿</div>
              <div class="font-medium">Nature</div>
              <div class="text-white/60 text-sm">Outdoorsy</div>
            </button>
          </div>
        </div>

        <!-- Step 2: Tier -->
        <div class="space-y-6 mt-8">
          <h3 class="text-xl font-semibold">Step 2: Select Tier & Features</h3>
          <div class="grid md:grid-cols-3 gap-6">
            <button class="tier-card glass rounded-xl p-6 border border-white/20 text-left" data-tier="basic" data-price="0.02">
              <div class="text-center mb-4">
                <div class="text-2xl mb-2">ğŸ¥‰</div>
                <h4 class="text-lg font-bold">Basic Memory</h4>
                <div class="text-yellow-400 font-bold text-xl">0.02 ETH</div>
                <div class="text-white/60 text-sm">~$<span class="usd">â€”</span></div>
              </div>
              <ul class="text-white/80 text-sm space-y-2">
                <li>âœ“ 1 Photo or Video</li>
                <li>âœ“ Basic Template</li>
                <li>âœ“ Pet Name & Date</li>
                <li>âœ“ Short Message (50 words)</li>
                <li>âœ“ Standard Quality</li>
              </ul>
            </button>

            <button class="tier-card glass rounded-xl p-6 border-2 border-yellow-400/60 text-left" data-tier="premium" data-price="0.05">
              <div class="text-center mb-4">
                <div class="text-2xl mb-2">ğŸ¥ˆ</div>
                <h4 class="text-lg font-bold">Premium Memory</h4>
                <div class="text-yellow-400 font-bold text-xl">0.05 ETH</div>
                <div class="text-white/60 text-sm">~$<span class="usd">â€”</span></div>
                <div class="bg-yellow-400/20 text-yellow-300 text-xs px-2 py-1 rounded mt-1">POPULAR</div>
              </div>
              <ul class="text-white/80 text-sm space-y-2">
                <li>âœ“ Up to 5 Photos/Videos</li>
                <li>âœ“ Premium Templates</li>
                <li>âœ“ Custom Animations</li>
                <li>âœ“ Extended Message (200 words)</li>
                <li>âœ“ HD Quality</li>
                <li>âœ“ Music Background</li>
              </ul>
            </button>

            <button class="tier-card glass rounded-xl p-6 border border-purple-400/40 text-left" data-tier="deluxe" data-price="0.10">
              <div class="text-center mb-4">
                <div class="text-2xl mb-2">ğŸ¥‡</div>
                <h4 class="text-lg font-bold">Deluxe Memory</h4>
                <div class="text-yellow-400 font-bold text-xl">0.10 ETH</div>
                <div class="text-white/60 text-sm">~$<span class="usd">â€”</span></div>
              </div>
              <ul class="text-white/80 text-sm space-y-2">
                <li>âœ“ Unlimited Media</li>
                <li>âœ“ All Premium Features</li>
                <li>âœ“ 3D Animations</li>
                <li>âœ“ Interactive Elements</li>
                <li>âœ“ 4K Quality</li>
                <li>âœ“ Custom Music</li>
                <li>âœ“ Shareable Links</li>
              </ul>
            </button>
          </div>
        </div>

        <div class="mt-8 text-center">
          <button id="toServiceFromLifetime" class="bg-gradient-to-r from-green-500 to-green-600 px-8 py-3 rounded-lg font-semibold text-lg hover:from-green-400 hover:to-green-500 disabled:opacity-50" disabled>
            Continue to Service Selection â†’
          </button>
        </div>
      </div>
    </section>

    <!-- RESTING VIEW -->
    <section id="restingView" class="hidden space-y-8">
      <div class="flex items-center justify-between">
        <button class="flex items-center gap-2 text-white/80 hover:text-white" id="backFromResting">â€¹ Back to Home</button>
        <h2 class="text-3xl font-bold">ğŸ•Šï¸ Resting Memorial</h2>
        <div></div>
      </div>

      <div class="glass rounded-2xl p-6 border border-blue-400/30">
        <p class="text-white/90 text-center mb-6">Create a beautiful, eternal tribute for a beloved pet who has crossed the rainbow bridge.</p>

        <!-- Step 1: Style -->
        <div class="space-y-6">
          <h3 class="text-xl font-semibold">Step 1: Choose Memorial Style</h3>
          <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
            <button class="tier-card glass rounded-lg p-4 border border-white/20 text-center" data-template="peaceful">
              <div class="text-3xl mb-2">ğŸŒ¸</div>
              <div class="font-medium">Peaceful</div>
              <div class="text-white/60 text-sm">Serene & Gentle</div>
            </button>
            <button class="tier-card glass rounded-lg p-4 border border-white/20 text-center" data-template="garden">
              <div class="text-3xl mb-2">ğŸŒ¹</div>
              <div class="font-medium">Garden</div>
              <div class="text-white/60 text-sm">Natural Beauty</div>
            </button>
            <button class="tier-card glass rounded-lg p-4 border border-white/20 text-center" data-template="heavenly">
              <div class="text-3xl mb-2">â˜ï¸</div>
              <div class="font-medium">Heavenly</div>
              <div class="text-white/60 text-sm">Spiritual & Pure</div>
            </button>
            <button class="tier-card glass rounded-lg p-4 border border-white/20 text-center" data-template="classic">
              <div class="text-3xl mb-2">ğŸ›ï¸</div>
              <div class="font-medium">Classic</div>
              <div class="text-white/60 text-sm">Timeless & Noble</div>
            </button>
          </div>
        </div>

        <!-- Step 2: Package -->
        <div class="space-y-6 mt-8">
          <h3 class="text-xl font-semibold">Step 2: Select Memorial Package</h3>
          <div class="grid md:grid-cols-3 gap-6">
            <button class="tier-card glass rounded-xl p-6 border border-white/20 text-left" data-tier="simple" data-price="0.03">
              <div class="text-center mb-4">
                <div class="text-2xl mb-2">ğŸ•¯ï¸</div>
                <h4 class="text-lg font-bold">Simple Memorial</h4>
                <div class="text-yellow-400 font-bold text-xl">0.03 ETH</div>
                <div class="text-white/60 text-sm">~$<span class="usd">â€”</span></div>
              </div>
              <ul class="text-white/80 text-sm space-y-2">
                <li>âœ“ Memorial Photo</li>
                <li>âœ“ Pet Details (name, dates)</li>
                <li>âœ“ Tribute Message</li>
                <li>âœ“ Basic Memorial Design</li>
                <li>âœ“ Permanent Onâ€‘Chain Storage</li>
              </ul>
            </button>

            <button class="tier-card glass rounded-xl p-6 border-2 border-blue-400/60 text-left" data-tier="complete" data-price="0.08">
              <div class="text-center mb-4">
                <div class="text-2xl mb-2">ğŸ’™</div>
                <h4 class="text-lg font-bold">Complete Memorial</h4>
                <div class="text-yellow-400 font-bold text-xl">0.08 ETH</div>
                <div class="text-white/60 text-sm">~$<span class="usd">â€”</span></div>
                <div class="bg-blue-400/20 text-blue-300 text-xs px-2 py-1 rounded mt-1">RECOMMENDED</div>
              </div>
              <ul class="text-white/80 text-sm space-y-2">
                <li>âœ“ Photo Gallery (up to 10)</li>
                <li>âœ“ Life Story Section</li>
                <li>âœ“ Favorite Memories</li>
                <li>âœ“ Premium Memorial Designs</li>
                <li>âœ“ Background Music</li>
                <li>âœ“ Shareable Memorial Link</li>
              </ul>
            </button>

            <button class="tier-card glass rounded-xl p-6 border border-purple-400/40 text-left" data-tier="legacy" data-price="0.15">
              <div class="text-center mb-4">
                <div class="text-2xl mb-2">ğŸ‘‘</div>
                <h4 class="text-lg font-bold">Legacy Memorial</h4>
                <div class="text-yellow-400 font-bold text-xl">0.15 ETH</div>
                <div class="text-white/60 text-sm">~$<span class="usd">â€”</span></div>
              </div>
              <ul class="text-white/80 text-sm space-y-2">
                <li>âœ“ Everything in Complete</li>
                <li>âœ“ Video Tributes</li>
                <li>âœ“ Interactive Timeline</li>
                <li>âœ“ Custom Memorial Page</li>
                <li>âœ“ Guest Book for Condolences</li>
                <li>âœ“ Anniversary Reminders</li>
                <li>âœ“ Physical Memorial Certificate</li>
              </ul>
            </button>
          </div>
        </div>

        <div class="mt-8 text-center">
          <button id="toServiceFromResting" class="bg-gradient-to-r from-blue-500 to-blue-600 px-8 py-3 rounded-lg font-semibold text-lg hover:from-blue-400 hover:to-blue-500 disabled:opacity-50" disabled>
            Continue to Service Selection â†’
          </button>
        </div>
      </div>
    </section>

    <!-- SERVICE SELECTION VIEW -->
    <section id="serviceSelectionView" class="hidden space-y-8">
      <div class="flex items-center justify-between">
        <button id="backFromService" class="flex items-center gap-2 text-white/80 hover:text-white">â€¹ Back</button>
        <h2 class="text-3xl font-bold">Choose Your Service</h2>
        <div></div>
      </div>

      <div class="glass rounded-2xl p-8 border border-white/20">
        <p class="text-white/90 text-center mb-8 text-lg">How would you like to create your memorial NFT?</p>
        <div class="grid md:grid-cols-2 gap-8 max-w-4xl mx-auto">
          <button class="tier-card glass rounded-xl p-6 border-2 border-purple-400/40 hover:bg-purple-400/10" data-service="self">
            <div class="text-center mb-6">
              <div class="text-5xl mb-4">ğŸ”§</div>
              <h3 class="text-xl font-bold mb-2">Selfâ€‘Service Minting</h3>
              <div class="bg-purple-400/20 text-purple-300 text-sm px-3 py-1 rounded-full inline-block mb-4">For Crypto Experts</div>
            </div>
            <ul class="text-white/80 text-sm space-y-3 mb-6">
              <li>âœ“ Full control over the minting process</li>
              <li>âœ“ Direct blockchain interaction</li>
              <li>âœ“ No service fee</li>
              <li>âœ“ Immediate NFT ownership</li>
            </ul>
            <div class="text-purple-300 font-semibold text-center">I'll Mint It Myself â†’</div>
          </button>

          <button class="tier-card glass rounded-xl p-6 border-2 border-green-400/40 hover:bg-green-400/10" data-service="full">
            <div class="text-center mb-6">
              <div class="text-5xl mb-4">ğŸ¤</div>
              <h3 class="text-xl font-bold mb-2">Full Service</h3>
              <div class="bg-green-400/20 text-green-300 text-sm px-3 py-1 rounded-full inline-block mb-4">We Handle Everything</div>
            </div>
            <ul class="text-white/80 text-sm space-y-3 mb-6">
              <li>âœ“ We mint the NFT for you</li>
              <li>âœ“ No technical knowledge needed</li>
              <li>âœ“ Professional design assistance</li>
              <li>âœ“ Quality assurance & support</li>
            </ul>
            <div class="text-green-300 font-semibold text-center">Create It For Me â†’</div>
          </button>
        </div>

        <!-- Dynamic Pricing Summary -->
        <div class="mt-10 glass rounded-xl p-6 border border-white/20">
          <h4 class="text-lg font-semibold mb-4 text-center">Pricing Summary</h4>
          <div class="grid md:grid-cols-3 gap-4 text-sm">
            <div class="glass rounded-lg p-4 border border-white/10">
              <div class="text-white/60">Selected Package</div>
              <div class="font-semibold" id="summaryPackage">â€”</div>
            </div>
            <div class="glass rounded-lg p-4 border border-white/10">
              <div class="text-white/60">Base Price</div>
              <div class="font-semibold"><span id="baseEth">â€”</span> ETH â€¢ ~$<span id="baseUsd">â€”</span></div>
            </div>
            <div class="glass rounded-lg p-4 border border-white/10">
              <div class="text-white/60">Fullâ€‘Service Fee</div>
              <div class="font-semibold">+ 0.01 ETH â€¢ ~$<span id="feeUsd">â€”</span></div>
            </div>
          </div>
          <div class="grid md:grid-cols-2 gap-4 mt-4 text-center">
            <div class="glass rounded-lg p-4 border border-white/10">
              <div class="text-white/60">Total (Selfâ€‘Service)</div>
              <div class="text-xl font-bold"><span id="totalSelfEth">â€”</span> ETH â€¢ ~$<span id="totalSelfUsd">â€”</span></div>
            </div>
            <div class="glass rounded-lg p-4 border border-white/10">
              <div class="text-white/60">Total (Full Service)</div>
              <div class="text-xl font-bold"><span id="totalFullEth">â€”</span> ETH â€¢ ~$<span id="totalFullUsd">â€”</span></div>
            </div>
          </div>
        </div>

        <div class="mt-8 text-center">
          <button id="serviceContinue" class="bg-gradient-to-r from-purple-500 to-purple-600 px-8 py-3 rounded-lg font-semibold text-lg hover:from-purple-400 hover:to-purple-500 disabled:opacity-50" disabled>
            Continue â†’
          </button>
        </div>

        <!-- Comparison Table -->
        <div class="mt-10 glass rounded-xl p-6 border border-white/20">
          <h4 class="text-lg font-semibold mb-4 text-center">Service Comparison</h4>
          <div class="overflow-x-auto">
            <table class="w-full text-sm">
              <thead>
                <tr class="border-b border-white/20">
                  <th class="text-left text-white/80 pb-2">Feature</th>
                  <th class="text-center text-white/80 pb-2">Selfâ€‘Service</th>
                  <th class="text-center text-white/80 pb-2">Full Service</th>
                </tr>
              </thead>
              <tbody>
                <tr class="border-b border-white/10">
                  <td class="py-2">Technical Knowledge</td>
                  <td class="text-center text-yellow-400">Required</td>
                  <td class="text-center text-green-400">Not Required</td>
                </tr>
                <tr class="border-b border-white/10">
                  <td class="py-2">Processing Time</td>
                  <td class="text-center text-green-400">Immediate</td>
                  <td class="text-center text-blue-400">2â€“3 business days</td>
                </tr>
                <tr class="border-b border-white/10">
                  <td class="py-2">Additional Fee</td>
                  <td class="text-center">None</td>
                  <td class="text-center text-yellow-400">+0.01 ETH</td>
                </tr>
                <tr>
                  <td class="py-2">Support Level</td>
                  <td class="text-center">Basic</td>
                  <td class="text-center text-green-400">Full</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </section>

    <!-- CUSTOMIZATION VIEW -->
    <section id="customizationView" class="hidden space-y-8">
      <div class="flex items-center justify-between">
        <button id="backFromCustomization" class="flex items-center gap-2 text-white/80 hover:text-white">â€¹ Back</button>
        <h2 id="customizationTitle" class="text-3xl font-bold">Customize Your Memorial</h2>
        <div></div>
      </div>

      <div class="glass rounded-2xl p-8 border border-white/20">
        <div class="grid md:grid-cols-2 gap-6 mb-8">
          <label class="block">
            <span class="block text-sm mb-2">Pet Name *</span>
            <input id="petName" class="w-full p-3 rounded-lg bg-white/10 placeholder-white/60 border border-white/30 focus:border-yellow-400 focus:outline-none" placeholder="Enter your pet's name" />
          </label>
          <label class="block">
            <span class="block text-sm mb-2">Pet Type</span>
            <select id="petType" class="w-full p-3 rounded-lg bg-white/10 border border-white/30 focus:border-yellow-400 focus:outline-none">
              <option>Dog</option>
              <option>Cat</option>
              <option>Bird</option>
              <option>Other</option>
            </select>
          </label>
          <label class="block md:col-span-2">
            <span class="block text-sm mb-2">Message</span>
            <textarea id="message" class="w-full p-3 rounded-lg bg-white/10 placeholder-white/60 border border-white/30 focus:border-yellow-400 focus:outline-none h-24" placeholder="Share a loving memory or tribute..."></textarea>
          </label>
          <label class="block">
            <span class="block text-sm mb-2">Memorial Date</span>
            <input id="memorialDate" type="date" class="w-full p-3 rounded-lg bg-white/10 border border-white/30 focus:border-yellow-400 focus:outline-none" />
          </label>
          <label class="block">
            <span class="block text-sm mb-2">Media URL (optional)</span>
            <input id="mediaUrl" class="w-full p-3 rounded-lg bg-white/10 placeholder-white/60 border border-white/30 focus:border-yellow-400 focus:outline-none" placeholder="https://... or ipfs://..." />
          </label>
        </div>

        <div class="grid md:grid-cols-2 gap-6 items-start">
          <div class="glass rounded-xl p-6 border border-white/10">
            <h3 class="font-semibold text-lg mb-3">Your Selection</h3>
            <div class="text-sm grid grid-cols-2 gap-2">
              <div class="text-white/60">Flow</div><div id="selFlow">â€”</div>
              <div class="text-white/60">Template</div><div id="selTemplate">â€”</div>
              <div class="text-white/60">Package</div><div id="selPackage">â€”</div>
              <div class="text-white/60">Service</div><div id="selService">â€”</div>
            </div>
            <div class="mt-4 border-t border-white/10 pt-4 text-sm">
              <div class="text-white/60">Total</div>
              <div class="text-xl font-bold"><span id="selTotalEth">â€”</span> ETH â€¢ ~$<span id="selTotalUsd">â€”</span></div>
            </div>
          </div>

          <div class="glass rounded-xl p-6 border border-white/10">
            <h3 class="font-semibold text-lg mb-3">Next Step</h3>
            <div id="fullServiceForm" class="hidden space-y-3">
              <label class="block">
                <span class="block text-sm mb-1">Contact Email *</span>
                <input id="contactEmail" class="w-full p-3 rounded-lg bg-white/10 border border-white/30 focus:border-yellow-400 focus:outline-none" placeholder="you@example.com" />
              </label>
              <label class="block">
                <span class="block text-sm mb-1">Notes / Special requests</span>
                <textarea id="notes" class="w-full p-3 rounded-lg bg-white/10 border border-white/30 focus:border-yellow-400 focus:outline-none h-20" placeholder="Optional"></textarea>
              </label>
              <p class="text-xs text-white/60">Delivery in 2â€“3 business days. We'll email updates and a preview link.</p>
            </div>
            <button id="finalCta" class="mt-2 w-full bg-gradient-to-r from-purple-500 to-purple-600 px-6 py-3 rounded-lg font-semibold hover:from-purple-400 hover:to-purple-500">Continue</button>
          </div>
        </div>
      </div>
    </section>

    <!-- GALLERY VIEW (simple demo) -->
    <section id="galleryView" class="hidden space-y-8">
      <div class="flex items-center justify-between">
        <button id="backFromGallery" class="flex items-center gap-2 text-white/80 hover:text-white">â€¹ Back to Home</button>
        <h2 class="text-3xl font-bold">Memorial Gallery</h2>
        <div></div>
      </div>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
        <div class="glass rounded-xl p-6 border border-white/20"><div class="text-4xl">ğŸ¶</div><div class="mt-2 font-semibold">Nani</div><div class="text-white/60 text-sm">Forever in our hearts</div></div>
        <div class="glass rounded-xl p-6 border border-white/20"><div class="text-4xl">ğŸ•â€ğŸ¦º</div><div class="mt-2 font-semibold">Pincher</div><div class="text-white/60 text-sm">Guardian of our family</div></div>
        <div class="glass rounded-xl p-6 border border-white/20"><div class="text-4xl">ğŸ¦®</div><div class="mt-2 font-semibold">Luna</div><div class="text-white/60 text-sm">Best friend ever</div></div>
      </div>
    </section>
  </main>

  <script>
    // ---- Chain / Contract (Arbitrum One) ----
    const ARBITRUM_CHAIN_ID_HEX = "0xa4b1"; // 42161
    const CONTRACT_ADDR = "0x56917d2838855B9A89f5B893Acc8DDA3cF4D6029";
    const PIP_ABI = [
      "function mint(string,string,uint8,string) payable",
      "function mintWithToken(string,string,uint8,string,address)",
      "function getMediaPrice(uint8) view returns (uint256 ethPrice, uint256 usdPrice)",
      "function getMemorial(uint256) view returns (tuple(string petName,string memorialDate,uint8 mediaType,string mediaURI,uint256 mintTimestamp,uint256 ethPaid,bool isLocked))",
      "function getTotalSupply() view returns (uint256)",
      "function getAcceptedTokens() view returns (address[])",
      "function getTokenPrice(uint8,address) view returns (uint256 amount, bool enabled)",
      "event MemorialMinted(uint256 indexed tokenId, address indexed to, string petName, uint8 mediaType)",
      "event Transfer(address indexed from, address indexed to, uint256 indexed tokenId)"
    ];

    // Map UI package â†’ on-chain MediaType (0=Photo,1=Video,2=Animation)
    const MEDIA_TYPE_BY_PACKAGE = { basic:0, premium:1, deluxe:2, simple:0, complete:1, legacy:2 };

    async function ensureArbitrumProvider() {
      if (!window.ethereum) throw new Error("No wallet found. Please install MetaMask.");
      const provider = new ethers.BrowserProvider(window.ethereum);
      const net = await provider.getNetwork();
      if (Number(net.chainId) !== 42161) {
        await window.ethereum.request({ method: "wallet_switchEthereumChain", params: [{ chainId: ARBITRUM_CHAIN_ID_HEX }] });
      }
      return provider;
    }

    async function getContract(readonly=false) {
      const provider = await ensureArbitrumProvider();
      if (readonly) return new ethers.Contract(CONTRACT_ADDR, PIP_ABI, provider);
      const signer = await provider.getSigner();
      return new ethers.Contract(CONTRACT_ADDR, PIP_ABI, signer);
    }

    async function fetchOnchainPriceForCurrentSelection() {
      try {
        if (!state.tierKey) return;
        const mediaType = MEDIA_TYPE_BY_PACKAGE[state.tierKey];
        const c = await getContract(true);
        const [wei] = await c.getMediaPrice(mediaType);
        const eth = Number(ethers.formatEther(wei));
        state.baseEth = eth; // prefer on-chain price over static card price
        updatePricingSummary();
        updateCustomizationSummary();
      } catch (e) {
        console.debug("getMediaPrice failed, using fallback:", e?.message || e);
      }
    }

    async function connectWallet() {
      if (!window.ethereum) { alert("Please install MetaMask."); return; }
      await window.ethereum.request({ method: 'eth_requestAccounts' });
      try { await ensureArbitrumProvider(); } catch (_) {}
      const accts = await window.ethereum.request({ method: 'eth_accounts' });
      const btn = document.getElementById('connectBtn');
      btn.textContent = (accts && accts[0]) ? `ğŸ‘› ${accts[0].slice(0,6)}â€¦${accts[0].slice(-4)}` : 'ğŸ‘› Connect Wallet';
    }

    async function mintNowSelfService() {
      try {
        const petName = document.getElementById('petName').value.trim();
        const memorialDate = document.getElementById('memorialDate').value;
        const mediaURI = document.getElementById('mediaUrl').value.trim();
        if (!petName) { alert("Please enter your pet's name."); return; }
        if (!state.tierKey) { alert('Please choose a package.'); return; }
        if (!mediaURI) { alert('Please provide an ipfs:// or https:// media URL.'); return; }

        const mediaType = MEDIA_TYPE_BY_PACKAGE[state.tierKey] ?? 0;

        // Read on-chain price (safer). Fallback to UI price if needed.
        let valueWei;
        try {
          const cRead = await getContract(true);
          const [wei] = await cRead.getMediaPrice(mediaType);
          valueWei = wei;
        } catch {
          valueWei = ethers.parseEther(String(state.baseEth || 0));
        }

        const c = await getContract(false);
        const tx = await c.mint(petName, memorialDate, mediaType, mediaURI, { value: valueWei });
        const receipt = await tx.wait();

        // Try to extract tokenId
        let tokenId = null;
        const iface = new ethers.Interface(PIP_ABI);
        for (const log of receipt.logs) {
          try {
            const parsed = iface.parseLog(log);
            if (parsed.name === 'MemorialMinted') { tokenId = parsed.args.tokenId.toString(); break; }
            if (parsed.name === 'Transfer' && parsed.args.from === '0x0000000000000000000000000000000000000000') { tokenId = parsed.args.tokenId.toString(); break; }
          } catch {}
        }
        const url = `https://arbiscan.io/tx/${receipt.hash}`;
        alert(`Mint successful!

Token ID: ${tokenId ?? '(detected)'}
Tx: ${url}`);
        showHome();
      } catch (err) {
        console.error(err);
        alert(`Mint failed: ${err?.shortMessage || err?.message || err}`);
      }
    }

    // ---- Global State ----
    const state = {
      flow: null,              // 'lifetime' | 'resting'
      template: null,          // 'playful' | ...
      tierKey: null,           // 'basic' | 'premium' | 'deluxe' | ...
      baseEth: 0,              // numeric ETH for selected package
      service: null,           // 'self' | 'full'
      feeEth: 0.01,            // full-service fee
      ethUsd: 3000             // fallback USD rate
    };

    // Try to fetch live ETHâ†’USD
    fetch('https://api.coingecko.com/api/v3/simple/price?ids=ethereum&vs_currencies=usd')
      .then(r => r.json()).then(j => {
        if (j && j.ethereum && j.ethereum.usd) {
          state.ethUsd = j.ethereum.usd;
          document.querySelectorAll('.usd').forEach(el => {
            const card = el.closest('[data-price]');
            if (card) { const eth = parseFloat(card.dataset.price); el.textContent = (eth * state.ethUsd).toFixed(0); }
          });
          updatePricingSummary();
          updateCustomizationSummary();
        }
      }).catch(() => {});

    // ---- Helpers ----
    const $ = s => document.querySelector(s);
    const show = id => document.querySelectorAll('main > section').forEach(sec => sec.id === id ? sec.classList.remove('hidden') : sec.classList.add('hidden'));
    const fmt = n => Number(n).toFixed(2);

    function updateTierUSDLabels(scope) {
      scope.querySelectorAll('[data-price] .usd').forEach(el => {
        const card = el.closest('[data-price]');
        const eth = parseFloat(card.dataset.price);
        el.textContent = (eth * state.ethUsd).toFixed(0);
      });
    }

    function selectTemplate(button) {
      const parent = button.parentElement; // grid container
      parent.querySelectorAll('.tier-card').forEach(b => b.classList.remove('selected-tier'));
      button.classList.add('selected-tier');
      state.template = button.dataset.template;
    }

    function selectTier(button) {
      const grid = button.parentElement; // grid of tiers
      grid.querySelectorAll('.tier-card').forEach(b => b.classList.remove('selected-tier'));
      button.classList.add('selected-tier');
      state.tierKey = button.dataset.tier;
      // start from card price, then override with on-chain price
      state.baseEth = parseFloat(button.dataset.price);
      updatePricingSummary();
      updateCustomizationSummary();
      fetchOnchainPriceForCurrentSelection();
      // enable continue button for current flow
      if (state.flow === 'lifetime') $('#toServiceFromLifetime').disabled = false;
      if (state.flow === 'resting')  $('#toServiceFromResting').disabled  = false;
    }

    function selectService(button) {
      const grid = button.parentElement; // grid of service cards (two cols)
      grid.querySelectorAll('.tier-card').forEach(b => b.classList.remove('selected-tier'));
      button.classList.add('selected-tier');
      state.service = button.dataset.service; // 'self' | 'full'
      // Set CTA text
      const cta = $('#serviceContinue');
      if (state.service === 'self') {
        title.textContent = 'Finalize & Mint';
        fullForm.classList.add('hidden');
        cta.textContent = 'Mint Now';
      } else {
        title.textContent = 'Provide Details (Full Service)';
        fullForm.classList.remove('hidden');
        cta.textContent = 'Place Fullâ€‘Service Order';
      }
      cta.disabled = false;
      updateCustomizationSummary();
    }

    function updatePricingSummary() {
      $('#summaryPackage').textContent = state.tierKey ? prettyTier(state.tierKey) : 'â€”';
      $('#baseEth').textContent = state.baseEth ? fmt(state.baseEth) : 'â€”';
      $('#baseUsd').textContent = state.baseEth ? (state.baseEth * state.ethUsd).toFixed(0) : 'â€”';
      $('#feeUsd').textContent  = (state.feeEth * state.ethUsd).toFixed(0);
      const selfEth = state.baseEth || 0;
      const fullEth = (state.baseEth || 0) + state.feeEth;
      $('#totalSelfEth').textContent = fmt(selfEth);
      $('#totalSelfUsd').textContent = (selfEth * state.ethUsd).toFixed(0);
      $('#totalFullEth').textContent = fmt(fullEth);
      $('#totalFullUsd').textContent = (fullEth * state.ethUsd).toFixed(0);
    }

    function updateCustomizationSummary() {
      $('#selFlow').textContent = state.flow ? (state.flow === 'lifetime' ? 'Lifetime Memories' : 'Resting Memorial') : 'â€”';
      $('#selTemplate').textContent = state.template || 'â€”';
      $('#selPackage').textContent = state.tierKey ? prettyTier(state.tierKey) : 'â€”';
      $('#selService').textContent = state.service === 'self' ? 'Selfâ€‘Service' : (state.service === 'full' ? 'Full Service' : 'â€”');
      const totalEth = state.service === 'full' ? (state.baseEth || 0) + state.feeEth : (state.baseEth || 0);
      $('#selTotalEth').textContent = fmt(totalEth);
      $('#selTotalUsd').textContent = (totalEth * state.ethUsd).toFixed(0);
      // title + form switch
      const title = $('#customizationTitle');
      const fullForm = $('#fullServiceForm');
      const cta = $('#finalCta');
      if (state.service === 'self') {
        title.textContent = 'Finalize & Mint';
        fullForm.classList.add('hidden');
        cta.textContent = 'Mint Now (Demo)';
      } else {
        title.textContent = 'Provide Details (Full Service)';
        fullForm.classList.remove('hidden');
        cta.textContent = 'Place Fullâ€‘Service Order';
      }
    }

    const prettyTier = k => ({ basic:'Basic Memory', premium:'Premium Memory', deluxe:'Deluxe Memory', simple:'Simple Memorial', complete:'Complete Memorial', legacy:'Legacy Memorial' }[k] || k);

    // ---- Navigation ----
    function showHome(){ show('homeView'); }
    function showLifetime(){ state.flow = 'lifetime'; show('lifetimeView'); }
    function showResting(){ state.flow = 'resting'; show('restingView'); }
    function showService(){ show('serviceSelectionView'); updatePricingSummary(); }
    function showCustomization(){ show('customizationView'); updateCustomizationSummary(); }
    function showGallery(){ show('galleryView'); }

    // ---- Event Wiring ----
    // Header
    $('#logoBtn').addEventListener('click', showHome);
    $('#galleryBtn').addEventListener('click', showGallery);
    $('#connectBtn').addEventListener('click', () => connectWallet());

    // Home
    $('#lifetimeBtn').addEventListener('click', showLifetime);
    $('#restingBtn').addEventListener('click', showResting);

    // Back buttons
    $('#backFromLifetime').addEventListener('click', showHome);
    $('#backFromResting').addEventListener('click', showHome);
    $('#backFromService').addEventListener('click', () => state.flow === 'lifetime' ? showLifetime() : showResting());
    $('#backFromCustomization').addEventListener('click', showService);
    $('#backFromGallery').addEventListener('click', showHome);

    // Template selections (delegate)
    document.querySelectorAll('#lifetimeView [data-template], #restingView [data-template]').forEach(btn => {
      btn.addEventListener('click', () => selectTemplate(btn));
    });

    // Tier selections
    document.querySelectorAll('#lifetimeView [data-tier], #restingView [data-tier]').forEach(btn => {
      btn.addEventListener('click', () => selectTier(btn));
    });

    // Update USD placeholders once initially
    updateTierUSDLabels(document);

    // Continue to service selection
    $('#toServiceFromLifetime').addEventListener('click', showService);
    $('#toServiceFromResting').addEventListener('click', showService);

    // Service selection cards
    document.querySelectorAll('#serviceSelectionView [data-service]').forEach(btn => {
      btn.addEventListener('click', () => selectService(btn));
    });

    // Continue from service to customization
    $('#serviceContinue').addEventListener('click', showCustomization);

    // Final CTA actions
    $('#finalCta').addEventListener('click', async () => {
      if (!state.baseEth || !state.tierKey) { alert('Please choose a package first.'); return; }
      const petName = $('#petName').value.trim();
      if (!petName) { alert('Please enter your pet\'s name.'); return; }
      if (state.service === 'self') {
        await connectWallet();
        await mintNowSelfService();
      } else {
        const email = $('#contactEmail').value.trim();
        if (!email) { alert('Please provide a contact email.'); return; }
        alert(`(Demo) Fullâ€‘service order placed!

We'll email ${email} within 2â€“3 business days with your preview.`);
        showHome();
      }
    });
  </script>
</body>
</html>
